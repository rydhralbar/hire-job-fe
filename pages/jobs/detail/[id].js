import React, { useState } from "react";
import axios from "axios";
import Head from "next/head";
import { useRouter } from "next/router";
import Navbar from "@/components/organisms/Navbar";
import Footer from "@/components/organisms/Footer";
import { TfiLocationPin } from "react-icons/tfi";
import mailLogo from "@/public/images/mail-logo.png";
import instaLogo from "@/public/images/instagram.svg";
import githubLogo from "@/public/images/github-logo.svg";
import gitlabLogo from "@/public/images/gitlab-logo.svg";
import Image from "next/image";
import styles from "@/styles/pages/Slug.module.scss";
import Link from "next/link";
import { useSelector } from "react-redux";

const ProfileDetail = (props) => {
  const { profile } = props;

  const talent = profile?.data?.[0]?.user;
  const skills = JSON.parse(profile?.data?.[0]?.skills);
  const portfolio = profile?.data?.[0]?.portfolios;
  const workExperience = profile?.data?.[0]?.work_experiences;

  const profileStalker = useSelector((state) => state.auth);

  const isRecruiter = profileStalker?.profile?.payload?.recruiter_id;

  const router = useRouter();

  const {
    query: { id },
  } = router;

  return (
    <>
      <Head>
        <title>
          {talent?.fullname?.charAt(0).toUpperCase() +
            talent?.fullname?.slice(1)}{" "}
          | Proworld
        </title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="/favicon.ico" />
      </Head>

      <main style={{ background: "#E5E5E5" }}>
        <Navbar />
        <div
          style={{
            background: "transparent",
            paddingTop: "10%",
            paddingBottom: "4.5%",
          }}
        >
          <div
            className={`container ${styles.containerContent}`}
            style={{ background: "white", borderRadius: "4px" }}
          >
            <div
              style={{
                backgroundColor: "#5e50a1",
                height: "210px",
                borderTopRightRadius: "4px",
                borderTopLeftRadius: "4px",
              }}
            >
              <div>
                <img
                  src={talent?.photo_profile}
                  // src={"https://www.its.ac.id/international/wp-content/uploads/sites/66/2020/02/blank-profile-picture-973460_1280.jpg"}
                  style={{
                    width: "170px",
                    marginLeft: "92px",
                    marginTop: "116px",
                    borderRadius: "50%",
                  }}
                  alt="Profile"
                />
              </div>
            </div>
            <div style={{ marginTop: "94px", marginLeft: "95px" }}>
              <h2>
                {/* {profile?.["user.fullname"]?.charAt(0)?.toUpperCase() +
                  profile?.["user.fullname"]?.slice(1)} */}
                {talent?.fullname?.charAt(0).toUpperCase() +
                  talent?.fullname?.slice(1)}
              </h2>
              <p style={{ marginTop: "15px" }}>
                {profile?.data?.[0]?.job.charAt(0).toUpperCase() +
                  profile?.data?.[0]?.job.slice(1)}
              </p>
              <div
                className="d-flex"
                style={{ marginBottom: "-6px", gap: "8px" }}
              >
                <TfiLocationPin />
                <p style={{ marginTop: "-5px", color: "#9EA0A5" }}>
                  {/* {profile?.domicile?.charAt(0).toUpperCase() +
                    profile?.domicile?.slice(1)} */}
                  {profile?.data?.[0]?.domicile.charAt(0).toUpperCase() +
                    profile?.data?.[0]?.domicile.slice(1)}
                </p>
              </div>
              <div>
                <p style={{ color: "#9EA0A5", width: "90%" }}>
                  {profile?.data?.[0]?.description?.charAt(0).toUpperCase() +
                    profile?.data?.[0]?.description?.slice(1)}
                </p>
              </div>
              <div>
                {isRecruiter && (
                  <button
                    className="btn btn-primary"
                    style={{ width: "33%", height: "55px", marginTop: "12px" }}
                    onClick={() => {
                      router.replace(`/jobs/hire/${id}`);
                    }}
                  >
                    Hire
                  </button>
                )}
              </div>
              <div>
                <h2 style={{ marginTop: "40px" }}>Skill</h2>
                <div className="d-flex" style={{ width: "90%" }}>
                  {skills.length > 0 ? (
                    <div className="row">
                      {skills.map((item, key) => (
                        <div
                          style={{ flex: "0 0 auto", width: "31%" }}
                          key={key}
                        >
                          <span
                            className={"badge bg-warning"}
                            style={{
                              marginTop: "10px",
                              marginRight: "12px",
                              height: "40px",
                              width: "95px",
                              padding: "13px",
                            }}
                          >
                            {item}
                          </span>
                        </div>
                      ))}
                    </div>
                  ) : (
                    <h5 className="mt-4">
                      {talent?.fullname} doesn't have any skills yet
                    </h5>
                  )}
                </div>
              </div>
              <div>
                <div style={{ display: "flex", marginTop: "35px" }}>
                  <Image
                    src={mailLogo}
                    alt="Mail"
                    style={{ width: "47px", height: "40px", marginTop: "6px" }}
                  />
                  <p
                    style={{
                      marginTop: "10px",
                      marginLeft: "20px",
                      color: "#9EA0A5",
                    }}
                  >
                    {talent?.fullname.toLowerCase().split(" ").join("")}
                    @gmail.com
                  </p>
                </div>
                <div style={{ display: "flex", marginTop: "12px" }}>
                  <Image
                    unoptimized={true}
                    src={instaLogo}
                    alt="Instagram"
                    style={{ width: "50px", height: "40px" }}
                  />
                  <p
                    style={{
                      marginTop: "7px",
                      marginLeft: "20px",
                      color: "#9EA0A5",
                    }}
                  >
                    {talent?.fullname.toLowerCase().split(" ").join("")}_
                  </p>
                </div>
                <div style={{ display: "flex", marginTop: "12px" }}>
                  <Image
                    unoptimized={true}
                    src={githubLogo}
                    alt="Github"
                    style={{ width: "50px", height: "40px" }}
                  />
                  <p
                    style={{
                      marginTop: "7px",
                      marginLeft: "20px",
                      color: "#9EA0A5",
                    }}
                  >
                    {talent?.fullname.toLowerCase().split(" ").join(".")}
                  </p>
                </div>
                <div style={{ display: "flex", marginTop: "12px" }}>
                  <Image
                    unoptimized={true}
                    src={gitlabLogo}
                    alt="Gitlab"
                    style={{ width: "50px", height: "40px" }}
                  />
                  <p
                    style={{
                      marginTop: "7px",
                      marginLeft: "20px",
                      color: "#9EA0A5",
                    }}
                  >
                    {talent?.fullname.toLowerCase().split(" ").join(".")}
                  </p>
                </div>
              </div>
              <div
                style={{
                  marginTop: "45px",
                  paddingTop: "30px",
                  paddingBottom: "30px",
                }}
              >
                <ul className="nav nav-tabs">
                  <li className="nav-item">
                    <button
                      className="nav-link text-dark"
                      id="nav-portfolio-tab"
                      data-bs-toggle="tab"
                      data-bs-target="#nav-portfolio"
                      type="button"
                      role="tab"
                      aria-controls="nav-portfolio"
                      aria-selected="true"
                    >
                      Portfolio
                    </button>
                  </li>
                  <li className="nav-item">
                    <button
                      className="nav-link text-dark"
                      id="nav-experience-tab"
                      data-bs-toggle="tab"
                      data-bs-target="#nav-experience"
                      type="button"
                      role="tab"
                      aria-controls="nav-experience"
                      aria-selected="false"
                    >
                      Work Experience
                    </button>
                  </li>
                </ul>
                <div className="tab-content" id="nav-tabContent">
                  <div
                    className="tab-pane fade show"
                    id="nav-portfolio"
                    role="tabpanel"
                    aria-labelledby="nav-portfolio-tab"
                  >
                    <div className="row">
                      {portfolio.length > 0 ? (
                        portfolio.map((item, key) => (
                          <div className="col-3" key={key}>
                            <img
                              src={item?.photo}
                              style={{
                                width: "175px",
                                height: "100px",
                                marginTop: "35px",
                                padding: "1px",
                                border: "2px solid #5E50A1",
                                objectFit: "cover",
                              }}
                              alt="Project"
                            />
                            <p
                              style={{
                                textAlign: "center",
                                paddingRight: "60px",
                                paddingTop: "5px",
                              }}
                            >
                              {item?.name}
                            </p>
                          </div>
                        ))
                      ) : (
                        <h4 className="mt-5">
                          {talent?.fullname?.charAt(0).toUpperCase() +
                            talent?.fullname.slice(1)}{" "}
                          doesn't have a portfolio yet
                        </h4>
                      )}
                    </div>
                  </div>
                  <div
                    className="tab-pane fade show"
                    id="nav-experience"
                    role="tabpanel"
                    aria-labelledby="nav-experience-tab"
                  >
                    {workExperience.length > 0 ? (
                      workExperience.map((item, key) => (
                        <>
                          <div
                            style={{ display: "flex", marginTop: "35px" }}
                            key={key}
                          >
                            <div>
                              <img
                                src={
                                  item?.photo ??
                                  "https://img.freepik.com/free-vector/thoughtful-woman-with-laptop-looking-big-question-mark_1150-39362.jpg?w=2000"
                                }
                                style={{
                                  width: "120px",
                                  marginRight: "35px",
                                  borderRadius: "5px",
                                }}
                                alt="Company"
                              />
                            </div>
                            <div style={{ width: "76%" }}>
                              <h3>{item?.position}</h3>
                              <h6>{item?.company}</h6>
                              <p style={{ color: "#9EA0A5" }}>
                                {/* 7 July 2021 - 1 January 2022 • 6 Months */}
                                {item?.date}
                              </p>
                              <p>{item?.description}</p>
                            </div>
                          </div>
                          <hr style={{ width: "91%" }} />
                        </>
                      ))
                    ) : (
                      <h4 className="mt-5">
                        {talent?.fullname?.charAt(0).toUpperCase() +
                          talent?.fullname.slice(1)}{" "}
                        has no work experience yet
                      </h4>
                    )}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </main>
      <Footer />
    </>
  );
};

// export const getStaticProps = async (context) => {
//   const {
//     query: { slug },
//   } = context;
//   const jobList = await axios.get(
//     `${process.env.NEXT_PUBLIC_API_URL}/v1/user/list`
//   );

//   const convert = jobList?.data?.find((res) => res?.["user.fullname" === slug]);

//   return {
//     props: {
//       jobLists: convert,
//     },
//     revalidate: 1800,
//   };
// };

export const getServerSideProps = async (context) => {
  const {
    query: { id },
  } = context;

  const jobList = await axios.get(
    `${process.env.NEXT_PUBLIC_API_URL}/v1/user/detail/${id}`
  );

  let convert = jobList?.data;

  return {
    props: {
      profile: convert,
    },
  };
};

export default ProfileDetail;
